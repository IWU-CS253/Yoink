{% extends "layout.html" %}

{% block body %}
    <style>
    input::placeholder{
        color: #00bb66;
        opacity: 4;
    }
</style>
    <!--The main page-->
    <div class="card" style="display: flex; justify-content: space-between; align-items: center;">
        <h2 style="margin: 0;">Latest posts</h2>
        <!--The search bar-->
        <div>
            <form action="{{ url_for('search')}}" method="post">
            <input style="height: .75rem; border-radius:8px; width: 50%; box-sizing: border-box; border:1px solid #0b6; color:#0b6;" type="text" placeholder="Item..." name="title" value="{{ items.title }}">
            <button  type="submit" class="btn btn-primary">Search</button>
            </form>
        </div>
        <!--Post button-->
        {% if session.get('user_id') %}
            <a class="btn primary" href="{{ url_for('create_item') }}">+ Post an item</a>
        {% endif %}
    </div>

<!--Shows all the posts currently in the databse-->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
{% for it in items %}
    <article class="card" style="display: flex; flex-direction: column; height: 100%; padding: 0; overflow: hidden; ">

        {% if it.image_path %}
            <img src="{{ url_for('static', filename=it.image_path) }}" alt="{{ it.title }}"
                 style="width:100%; height:250px; object-fit:cover;">
        {% else %}
            <div style="width: 100%; height: 250px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #999;">
                No image
            </div>
        {% endif %}

        <div style="padding: 1rem; flex:1; display: flex; flex-direction: column;">
            <h3 style="margin:0 0 0.5rem 0;">
                <a href="{{ url_for('item_detail', item_id=it.id) }}">{{ it.title }}</a>
            </h3>

            <p style="margin:0 0 0.5rem 0; color:#555; flex: 1">
                {{ it.description[:160] }}{% if it.description|length > 160 %}…{% endif %}</p>

            <div style="margin-top: auto;">
                <p style="margin:.25rem 0; color:#777; font-size:.9rem;">
                    {% if it.category %}
                        <span style="background: #3A7734; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.8rem">#{{ it.category }}</span>
                    {% endif %}

                    {% if it.condition %}
                        <span style="margin-left: 0.5rem;">{{ it.condition }} </span>
                    {% endif %}
                </p>

                <p style="margin: 0.5rem 0 0 0; color: #999; font-size: 0.8rem">
                    Posted by
                    <form method="post" action="{{ url_for('user_profile') }}" style="display: inline;">
                        <input type="hidden" name="profile_username" value="{{ it.username }}">
                        <button style="background: none; border: none; padding: 0; color: #00bb66" type="submit">{{ it.username }}</button>
                    </form>
                    · {{ it.created_at }}
                </p>
            </div>
        </div>
    </article>
    {% else %}
    <div class="card" style="grid-column-start: 1; grid-column-end: -1">
        No items yet. Be the first to <a href="{{ url_for('create_item') }}">post</a>!
    </div>
  {% endfor %}
</div>
    <style>
    @media (max-width: 768px) {
        div[style="grid-template-columns"] {
            grid-template-columns: 1fr;
        }
    }
    </style>
{% endblock %}
